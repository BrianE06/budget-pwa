<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Budget PWA</title>

  <link rel="manifest" href="manifest.webmanifest" />
  <meta name="theme-color" content="#111111" />

  <style>
    body { font-family: -apple-system, system-ui, Arial; margin: 16px; }
    .row { display:flex; gap:10px; flex-wrap:wrap; }
    input, select, button { font-size:16px; padding:10px; }
    button { cursor:pointer; }
    .card { border:1px solid #ddd; border-radius:12px; padding:12px; margin:12px 0; }
    #status { color:#555; }
    table { width:100%; border-collapse: collapse; }
    td, th { padding:8px; border-bottom:1px solid #eee; text-align:left; }

    /* Small pies (~20% of original big look) */
    .pieWrap { width: 140px; height: 140px; }
    .pieWrap canvas { width: 140px !important; height: 140px !important; }

    .legendTable { width:100%; border-collapse: collapse; }
    .legendTable td { padding:6px 8px; border-bottom:1px solid #eee; font-size:14px; }
    .dot { display:inline-block; width:10px; height:10px; border-radius:50%; margin-right:8px; vertical-align:middle; }
  </style>
</head>

<body>
  <h2>Budget Tracker (Local + OCR)</h2>
  <div id="status">Loadingâ€¦</div>

  <div class="card">
  <h3>Totals</h3>
  <div class="row">
    <div><b>Deposits:</b> <span id="totalDeposits">$0.00</span></div>
    <div><b>Expenses:</b> <span id="totalExpenses">$0.00</span></div>
    <div><b>Leftover (Net):</b> <span id="totalNet">$0.00</span></div>
    <div><b>Spend Rate:</b> <span id="spendRate">0.0%</span></div>
  </div>
</div>

  <div class="card">
    <h3>Add transaction</h3>
    <div class="row">
      <input id="date" type="date" />
      <select id="type">
        <option value="expense">Expense</option>
        <option value="income">Income</option>
      </select>
      <input id="amount" type="number" step="0.01" placeholder="Amount" />
      <input id="merchant" placeholder="Merchant" />
      <select id="category"></select>
      <button id="addBtn">Add</button>
    </div>
  </div>

  <div class="card">
    <h3>Import from screenshot (OCR)</h3>
    <p>Upload a screenshot where each line looks like: <b>MM/DD Merchant -12.34</b> (or similar).</p>
    <input id="imgInput" type="file" accept="image/*" />
    <div class="row">
      <button id="ocrBtn">Run OCR</button>
      <button id="importBtn" disabled>Import parsed rows</button>
    </div>
    <p id="ocrStatus"></p>
    <div id="preview"></div>
  </div>

  <div class="card">
    <h3>Filters</h3>
    <div class="row">
      <label>
        Month:
        <input id="monthFilter" type="month" />
      </label>
      <label style="display:flex; gap:8px; align-items:center;">
        <input id="showAll" type="checkbox" />
        Show all dates
      </label>
    </div>
  </div>

  <div class="card">
    <h3>Spending by Category</h3>
    <div class="row" style="align-items:flex-start;">
      <div class="pieWrap"><canvas id="pieExpenses"></canvas></div>
      <div id="legendExpenses" style="flex:1; min-width:220px;"></div>
    </div>
  </div>

  <div class="card">
    <h3>Deposits by Merchant (Top 12)</h3>
    <div class="row" style="align-items:flex-start;">
      <div class="pieWrap"><canvas id="pieDeposits"></canvas></div>
      <div id="legendDeposits" style="flex:1; min-width:220px;"></div>
    </div>
  </div>

  <div class="card">
    <h3>Expenses vs Deposits (Ratio)</h3>
    <div class="row" style="align-items:flex-start;">
      <div class="pieWrap"><canvas id="pieRatio"></canvas></div>
      <div id="legendRatio" style="flex:1; min-width:220px;"></div>
    </div>
  </div>

  <div class="card">
    <h3>Recent transactions</h3>
    <div id="txList"></div>
  </div>

  <!-- Libraries -->
  <script src="https://cdn.jsdelivr.net/npm/idb@8/build/umd.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>

  <!-- Your app -->
  <script src="app.js"></script>
</body>
</html>
